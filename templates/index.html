<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>TodoList</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center p-6">
    <div class="w-full max-w-4xl bg-white p-6 rounded-2xl shadow-lg">

        <!-- Header -->
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-bold">ğŸ“‹ TodoList</h1>
            <button onclick="openModal()" class="px-4 py-2 bg-blue-500 text-white rounded-xl hover:bg-blue-600">
                + æ–°å»ºä»»åŠ¡
            </button>
        </div>

        <!-- æœç´¢æ¡† -->
        <div class="flex items-center mb-4">
            <input id="searchInput" type="text" placeholder="æœç´¢ä»»åŠ¡..." class="w-full p-2 border rounded-xl"
                onkeyup="filterTasks()">
        </div>

        <!-- Todo åˆ—è¡¨ -->
        <ul id="todoList" class="space-y-2">
            <!-- JS åŠ¨æ€æ’å…¥ -->
        </ul>

        <!-- åˆ†é¡µ -->
        <div class="flex justify-between items-center mt-4">
            <button onclick="prevPage()" class="px-3 py-1 bg-gray-200 rounded-xl hover:bg-gray-300">ä¸Šä¸€é¡µ</button>
            <span id="pageInfo" class="text-gray-600">ç¬¬ 1 é¡µ</span>
            <button onclick="nextPage()" class="px-3 py-1 bg-gray-200 rounded-xl hover:bg-gray-300">ä¸‹ä¸€é¡µ</button>
        </div>
    </div>

    <!-- å‘å¸ƒå¼¹çª— -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-2xl w-96 shadow-lg">
            <h2 class="text-lg font-bold mb-4">æ–°å»ºä»»åŠ¡</h2>
            <input id="newTaskInput" type="text" placeholder="è¯·è¾“å…¥ä»»åŠ¡..." class="w-full p-2 border rounded-xl mb-4">
            <div class="flex justify-end space-x-2">
                <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 rounded-xl">å–æ¶ˆ</button>
                <button onclick="addTask()"
                    class="px-4 py-2 bg-blue-500 text-white rounded-xl hover:bg-blue-600">å‘å¸ƒ</button>
            </div>
        </div>
    </div>

    <script>
        let tasks = [
            { text: "å­¦ä¹  PHP", done: false },
            { text: "å†™åšå®¢æ–‡ç« ", done: true },
            { text: "è·‘æ­¥ 30 åˆ†é’Ÿ", done: false },
            { text: "çœ‹ä¸€æœ¬ä¹¦", done: false },
            { text: "æ•´ç†æ–‡ä»¶", done: true },
            { text: "å¼€å‘ TodoList é¡µé¢", done: false },
            { text: "åšæ™šé¥­", done: false },
            { text: "è”ç³»å®¢æˆ·", done: false },
            { text: "å‚åŠ ä¼šè®®", done: false },
            { text: "å†™å‘¨æŠ¥", done: false }
        ];

        let currentPage = 1;
        const pageSize = 5;

        function renderTasks() {
            const list = document.getElementById("todoList");
            list.innerHTML = "";
            const search = document.getElementById("searchInput").value.toLowerCase();

            let filtered = tasks.filter(t => t.text.toLowerCase().includes(search));
            const totalPages = Math.ceil(filtered.length / pageSize);

            if (currentPage > totalPages) currentPage = totalPages || 1;
            const start = (currentPage - 1) * pageSize;
            const pageItems = filtered.slice(start, start + pageSize);

            pageItems.forEach((task, index) => {
                const li = document.createElement("li");
                li.className = "p-3 bg-gray-50 border rounded-xl flex justify-between items-center hover:bg-gray-100";

                // å·¦ä¾§ï¼šä»»åŠ¡æ–‡æœ¬ + çŠ¶æ€
                const textDiv = document.createElement("div");
                textDiv.innerHTML = `
          <span class="${task.done ? 'line-through text-gray-400' : ''}">${task.text}</span>
          <span class="ml-2 text-sm ${task.done ? 'text-green-600' : 'text-red-500'}">
            ${task.done ? 'âœ” å·²å®Œæˆ' : 'âœ˜ æœªå®Œæˆ'}
          </span>
        `;

                // å³ä¾§ï¼šæ“ä½œæŒ‰é’®
                const btnDiv = document.createElement("div");
                btnDiv.className = "space-x-2";
                btnDiv.innerHTML = `
          <button onclick="toggleDone(${start + index})" class="px-2 py-1 text-sm rounded-lg ${task.done ? 'bg-yellow-400 hover:bg-yellow-500' : 'bg-green-500 hover:bg-green-600'} text-white">
            ${task.done ? 'æ’¤é”€' : 'å®Œæˆ'}
          </button>
          <button onclick="deleteTask(${start + index})" class="px-2 py-1 text-sm rounded-lg bg-red-500 hover:bg-red-600 text-white">åˆ é™¤</button>
        `;

                li.appendChild(textDiv);
                li.appendChild(btnDiv);
                list.appendChild(li);
            });

            document.getElementById("pageInfo").innerText = `ç¬¬ ${currentPage} é¡µ / å…± ${totalPages || 1} é¡µ`;
        }

        function filterTasks() {
            currentPage = 1;
            renderTasks();
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderTasks();
            }
        }

        function nextPage() {
            const search = document.getElementById("searchInput").value.toLowerCase();
            const filtered = tasks.filter(t => t.text.toLowerCase().includes(search));
            const totalPages = Math.ceil(filtered.length / pageSize);
            if (currentPage < totalPages) {
                currentPage++;
                renderTasks();
            }
        }

        function openModal() {
            document.getElementById("modal").classList.remove("hidden");
        }

        function closeModal() {
            document.getElementById("modal").classList.add("hidden");
        }

        function addTask() {
            const input = document.getElementById("newTaskInput");
            if (input.value.trim()) {
                fetch("/tasks", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ text: input.value })
                })
                    .then(res => res.json())
                    .then(data => {
                        console.log("æ–°å¢ä»»åŠ¡:", data);
                        renderTasks(); // åˆ·æ–°ä»»åŠ¡åˆ—è¡¨
                    });
                tasks.unshift({ text: input.value.trim(), done: false });
                input.value = "";
                closeModal();
                renderTasks();
            }
        }

        function toggleDone(index) {
            tasks[index].done = !tasks[index].done;
            renderTasks();
        }

        function deleteTask(index) {
            tasks.splice(index, 1);
            renderTasks();
        }

        // åˆå§‹åŒ–æ¸²æŸ“
        renderTasks();
    </script>
</body>

</html>